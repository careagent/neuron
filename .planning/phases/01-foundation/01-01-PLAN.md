---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml
  - tsconfig.json
  - tsdown.config.ts
  - vitest.config.ts
  - src/types/index.ts
  - src/types/common.ts
  - src/types/config.ts
  - src/types/relationship.ts
  - src/types/appointment.ts
  - src/types/billing.ts
  - src/types/audit.ts
  - src/types/termination.ts
  - src/types/sync.ts
autonomous: true
requirements:
  - FOUN-01
  - FOUN-08
must_haves:
  truths:
    - "pnpm install succeeds and all dependencies resolve"
    - "tsdown builds src/ to dist/ with .d.ts declarations"
    - "vitest runs with no errors (even if no tests yet)"
    - "All TypeBox schemas are importable from src/types/index.ts"
    - "Static<typeof Schema> produces correct TypeScript types for every schema"
  artifacts:
    - path: "package.json"
      provides: "Project manifest with all dependencies"
      contains: "@sinclair/typebox"
    - path: "tsconfig.json"
      provides: "TypeScript compiler configuration"
    - path: "tsdown.config.ts"
      provides: "Build configuration"
    - path: "vitest.config.ts"
      provides: "Test configuration with 80% coverage thresholds"
    - path: "src/types/index.ts"
      provides: "Barrel export of all TypeBox schemas"
      exports: ["NeuronConfigSchema", "RelationshipRecordSchema", "AppointmentSchema", "BillingRecordSchema", "AuditEntrySchema"]
  key_links:
    - from: "src/types/index.ts"
      to: "src/types/*.ts"
      via: "barrel re-exports"
      pattern: "export.*from"
---

<objective>
Bootstrap the Neuron project scaffold and define all core TypeBox data model schemas.

Purpose: Establish the build toolchain, testing framework, and shared type foundation that every subsequent plan depends on. TypeBox schemas are the single source of truth for both runtime validation and TypeScript type inference across the entire project.

Output: A buildable pnpm TypeScript project with all core data model schemas exported from `src/types/`.
</objective>

<execution_context>
@/Users/medomatic/.claude/get-shit-done/workflows/execute-plan.md
@/Users/medomatic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize pnpm TypeScript project with build and test toolchain</name>
  <files>
    package.json
    pnpm-workspace.yaml
    tsconfig.json
    tsdown.config.ts
    vitest.config.ts
    .gitignore
  </files>
  <action>
    Initialize a pnpm project at the repository root (not a monorepo workspace -- single project):

    1. Create `package.json` with:
       - name: `@careagent/neuron`
       - version: `0.1.0`
       - type: `module` (ESM)
       - bin: `{ "neuron": "./dist/cli/index.js" }`
       - main: `./dist/index.js`
       - types: `./dist/index.d.ts`
       - exports with `.` and `./types` subpath pointing to dist/
       - scripts: `build` (tsdown), `test` (vitest), `test:coverage` (vitest --coverage), `dev` (tsx src/cli/index.ts), `lint` (tsc --noEmit)
       - engines: `{ "node": ">=20.19.0" }` (required by tsdown)

    2. Install production dependencies:
       ```
       pnpm add @sinclair/typebox better-sqlite3 commander
       ```

    3. Install dev dependencies:
       ```
       pnpm add -D typescript@~5.7 tsdown@~0.20 vitest@~4.0 @types/better-sqlite3 @types/node @vitest/coverage-v8 tsx
       ```

    4. Create `tsconfig.json`:
       - target: ES2022
       - module: Node16 / moduleResolution: Node16
       - strict: true
       - outDir: ./dist
       - rootDir: ./src
       - declaration: true
       - esModuleInterop: true
       - skipLibCheck: true
       - include: ["src/**/*"]

    5. Create `tsdown.config.ts`:
       - entry: ["src/index.ts", "src/cli/index.ts"]
       - format: esm
       - dts: true
       - clean: true
       - outDir: "dist"

    6. Create `vitest.config.ts`:
       - test.coverage.provider: "v8"
       - test.coverage.thresholds: { lines: 80, functions: 80, branches: 80, statements: 80 }
       - test.coverage.include: ["src/**/*.ts"]
       - test.coverage.exclude: ["src/types/**", "src/**/*.d.ts"]
       - test.include: ["src/**/*.test.ts", "tests/**/*.test.ts"]

    7. Update `.gitignore` to include: node_modules/, dist/, coverage/, *.tsbuildinfo

    8. Create minimal `src/index.ts` that re-exports from `src/types/index.ts` (placeholder).

    Note: Do NOT create pnpm-workspace.yaml -- this is a single project, not a monorepo.
  </action>
  <verify>
    Run `pnpm install` -- must succeed with all dependencies resolved.
    Run `pnpm run lint` (tsc --noEmit) -- must pass with no type errors.
    Run `pnpm run build` -- must produce dist/ with .js and .d.ts files.
    Run `pnpm test` -- must exit cleanly (no tests yet, but no config errors).
  </verify>
  <done>
    pnpm install resolves all dependencies. tsc --noEmit passes. tsdown builds to dist/ with declarations. vitest runs without configuration errors. Project is ready for source code.
  </done>
</task>

<task type="auto">
  <name>Task 2: Define all core TypeBox data model schemas</name>
  <files>
    src/types/common.ts
    src/types/config.ts
    src/types/relationship.ts
    src/types/appointment.ts
    src/types/billing.ts
    src/types/audit.ts
    src/types/termination.ts
    src/types/sync.ts
    src/types/index.ts
  </files>
  <action>
    Create TypeBox schema definitions for all core data models. Each schema must be both a runtime JSON Schema object AND produce a TypeScript type via `Static<typeof Schema>`.

    **src/types/common.ts** -- Shared types:
    - `NpiString`: `Type.String({ pattern: '^\\d{10}$' })` for 10-digit NPI strings
    - `UuidString`: `Type.String({ format: 'uuid' })` for UUID identifiers
    - `IsoDateString`: `Type.String()` for ISO 8601 timestamps
    - `OrganizationType`: `Type.Union([Type.Literal('practice'), Type.Literal('hospital'), Type.Literal('pharmacy'), Type.Literal('imaging_center'), Type.Literal('laboratory'), Type.Literal('urgent_care'), Type.Literal('specialty_clinic'), Type.Literal('other')])`

    **src/types/config.ts** -- NeuronConfigSchema:
    - organization: { npi (NpiString), name (string, minLength 1), type (OrganizationType) }
    - server: { port (number, 1-65535, default 3000), host (string, default '0.0.0.0') }
    - storage: { path (string, default './data/neuron.db') }
    - audit: { path (string, default './data/audit.jsonl'), enabled (boolean, default true) }
    - localNetwork: { enabled (boolean, default false) }
    - heartbeat: { intervalMs (number, default 60000) }
    - All sections with reasonable defaults where applicable using TypeBox `default` keyword

    **src/types/relationship.ts** -- RelationshipRecordSchema:
    - relationship_id (UuidString), patient_agent_id (string), provider_npi (NpiString)
    - status: union of 'pending', 'active', 'suspended', 'terminated'
    - consented_actions: array of strings (e.g., 'chart_read', 'messaging')
    - created_at, updated_at (IsoDateString)

    **src/types/appointment.ts** -- AppointmentSchema + ProviderAvailabilitySchema:
    - AppointmentSchema: appointment_id (UuidString), relationship_id (UuidString), provider_npi (NpiString), scheduled_at (IsoDateString), duration_minutes (number), status: union of 'scheduled', 'confirmed', 'checked_in', 'in_progress', 'completed', 'cancelled', 'no_show', notes (optional string), created_at, updated_at
    - ProviderAvailabilitySchema: availability_id (UuidString), provider_npi (NpiString), type: union of 'recurring', 'one_time', 'block', day_of_week (optional number 0-6), start_time (string HH:MM), end_time (string HH:MM), effective_date (optional IsoDateString), expiry_date (optional IsoDateString)

    **src/types/billing.ts** -- BillingRecordSchema + CptEntrySchema:
    - CptEntrySchema: code (string), description (string), modifiers (optional array of strings), units (number, default 1)
    - BillingRecordSchema: billing_id (UuidString), relationship_id (UuidString), provider_npi (NpiString), appointment_id (optional UuidString), cpt_entries (array of CptEntrySchema), icd10_codes (array of strings), status: union of 'draft', 'submitted', 'accepted', 'denied', 'appealed', total_amount (optional number), created_at, updated_at

    **src/types/audit.ts** -- AuditEntrySchema + AuditCategorySchema:
    - AuditCategorySchema: union of 'registration', 'connection', 'consent', 'api_access', 'sync', 'admin', 'termination'
    - AuditEntrySchema: sequence (number), timestamp (IsoDateString), category (AuditCategorySchema), action (string), actor (optional string), details (optional record of string to unknown), prev_hash (string), hash (string)

    **src/types/termination.ts** -- TerminationRecordSchema:
    - termination_id (UuidString), relationship_id (UuidString), provider_npi (NpiString), reason (string), terminated_at (IsoDateString), audit_entry_sequence (optional number)

    **src/types/sync.ts** -- CachedChartEntrySchema + SyncStateSchema:
    - CachedChartEntrySchema: entry_id (UuidString), relationship_id (UuidString), content_hash (string, SHA-256), content (record), received_at (IsoDateString)
    - SyncStateSchema: relationship_id (UuidString), last_sync_at (IsoDateString), entry_count (number)

    **src/types/index.ts** -- Barrel export:
    - Re-export all schemas AND their Static types from each module
    - Export both the schema objects (e.g., `NeuronConfigSchema`) and the inferred types (e.g., `type NeuronConfig`)

    **Naming convention:** Schema objects are PascalCase with `Schema` suffix (e.g., `NeuronConfigSchema`). Inferred types use the same name without suffix (e.g., `type NeuronConfig = Static<typeof NeuronConfigSchema>`).

    After creating all schemas, run `pnpm run lint` to verify no type errors.
  </action>
  <verify>
    Run `pnpm run lint` (tsc --noEmit) -- all schemas must compile without type errors.
    Run `pnpm run build` -- dist/types/ must contain .js and .d.ts files for all schema modules.
    Verify barrel export: `import { NeuronConfigSchema, RelationshipRecordSchema, AppointmentSchema, BillingRecordSchema, AuditEntrySchema, TerminationRecordSchema, CachedChartEntrySchema, SyncStateSchema } from './src/types/index.ts'` must resolve.
  </verify>
  <done>
    All TypeBox schemas compile, build to dist/ with declarations, and are importable via the barrel export at src/types/index.ts. Each schema produces both a runtime JSON Schema object and a TypeScript type via Static<typeof>.
  </done>
</task>

</tasks>

<verification>
- `pnpm install` succeeds
- `pnpm run lint` passes (zero type errors)
- `pnpm run build` produces dist/ with .js and .d.ts files
- `pnpm test` runs without configuration errors
- All schemas importable from `src/types/index.ts`
- TypeScript types inferred correctly from schemas
</verification>

<success_criteria>
- Buildable TypeScript project with pnpm, tsdown, vitest
- 80% coverage thresholds configured in vitest
- All 8 TypeBox schema modules created with correct data models
- Barrel export at src/types/index.ts re-exports all schemas and types
- Project compiles and builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
